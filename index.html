<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>æ—¶é—´èƒ¶å›Šæ—¥å†</title>

<style>
:root{
  --bg:linear-gradient(180deg,#fef5ff 0%,#fdfdff 40%,#f3f9ff 100%);
  --card-glass:rgba(255,255,255,.82);
  --card-strong:rgba(255,255,255,.96);
  --primary:#ff7fae;
  --primary-deep:#ff4c8d;
  --accent:#ffd8ec;
  --text:#333;
  --radius-lg:22px;
  --radius-md:16px;
  --shadow-soft:0 18px 40px rgba(160,180,255,.30);
  --shadow-strong:0 20px 46px rgba(0,0,0,.18);
  font-size:16px;
}
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
  -webkit-tap-highlight-color:transparent;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
}
body{
  min-height:100vh;
  background:var(--bg);
  color:var(--text);
  padding:16px 14px 22px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* é¡¶éƒ¨ä¿¡æ¯å¡ç‰‡ */
.top-card{
  background:var(--card-glass);
  border-radius:var(--radius-lg);
  padding:12px 14px;
  display:flex;
  flex-direction:column;
  gap:10px;
  backdrop-filter:blur(18px);
  -webkit-backdrop-filter:blur(18px);
  box-shadow:var(--shadow-soft);
}
.top-row-1{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.brand{
  display:flex;
  align-items:center;
  gap:8px;
}
.brand-logo{
  width:38px;
  height:38px;
  border-radius:18px;
  background:conic-gradient(from 210deg,#ffb6da,#ff7fb5,#ffd1e8,#ffb6da);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-size:1.5rem;
  box-shadow:0 8px 18px rgba(255,127,181,.55);
}
.brand-text-main{
  font-size:1.05rem;
  font-weight:700;
  color:var(--primary-deep);
}
.brand-text-sub{
  font-size:.78rem;
  color:#777;
}
.btn-today{
  border:none;
  border-radius:999px;
  background:#fff;
  padding:6px 12px;
  font-size:.8rem;
  box-shadow:0 4px 10px rgba(0,0,0,.12);
  display:flex;
  align-items:center;
  gap:4px;
  cursor:pointer;
}
.btn-today:active{
  transform:scale(.95);
}
.top-row-2{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}
.pill{
  border-radius:999px;
  background:#fff;
  padding:6px 10px;
  font-size:.78rem;
  display:inline-flex;
  align-items:center;
  gap:4px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}
.pill-strong{
  background:linear-gradient(135deg,#ffb7dd,#ff7fb0);
  color:#fff;
}
.pill-strong code{
  font-family:inherit;
  font-size:.9em;
}

/* ä¸­éƒ¨é¢„è§ˆå¡ç‰‡ */
.preview-card{
  margin-top:4px;
  background:var(--card-strong);
  border-radius:var(--radius-lg);
  padding:14px 14px 16px;
  box-shadow:var(--shadow-strong);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.preview-head{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
}
.select-wrap{
  display:flex;
  align-items:center;
  gap:6px;
}
select{
  border-radius:999px;
  border:1px solid #e2e4f0;
  padding:4px 10px;
  font-size:.8rem;
  background:#fff;
  outline:none;
}
.preview-chips{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-top:4px;
}
.preview-chip{
  border-radius:999px;
  background:#f5f6ff;
  padding:4px 8px;
  font-size:.76rem;
  color:#666;
}
.preview-label{
  font-size:.86rem;
  font-weight:600;
  color:#555;
  margin-top:6px;
}
.preview-date{
  color:var(--primary-deep);
}
.preview-body{
  margin-top:4px;
  font-size:.88rem;
  line-height:1.6;
  white-space:pre-wrap;
  text-wrap:pretty;
}
.btn-open{
  margin-top:8px;
  align-self:flex-start;
  border:none;
  border-radius:999px;
  padding:8px 14px;
  font-size:.86rem;
  background:linear-gradient(135deg,#ff7fb5,#ff4c8d);
  color:#fff;
  display:flex;
  align-items:center;
  gap:4px;
  box-shadow:0 8px 18px rgba(255,76,141,.6);
  cursor:pointer;
}
.btn-open:active{
  transform:scale(.96) translateY(1px);
}

/* æ—¥å†å¡ç‰‡ */
.calendar-card{
  margin-top:12px;
  background:var(--card-strong);
  border-radius:var(--radius-lg);
  padding:12px 12px 14px;
  box-shadow:var(--shadow-soft);
}
.calendar-header{
  font-size:.8rem;
  color:#888;
  margin-bottom:6px;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}
.wd,
.day{
  aspect-ratio:1/1;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.8rem;
  font-weight:600;
}
.wd{
  color:#999;
}
.day{
  background:#f6f7ff;
  color:#444;
  box-shadow:0 2px 4px rgba(0,0,0,.08);
  position:relative;
  cursor:pointer;
  transition:.22s;
}
.day.disabled{
  background:transparent;
  box-shadow:none;
  cursor:default;
}
.day.has::after{
  content:attr(data-icon);
  position:absolute;
  bottom:5px;
  right:5px;
  font-size:.7rem;
}
.day.sel{
  background:#fff;
  box-shadow:0 0 0 2px var(--primary-deep),0 6px 12px rgba(255,76,141,.45);
  transform:translateY(-1px);
}
.day.today::before{
  content:"";
  width:6px;
  height:6px;
  border-radius:50%;
  background:var(--primary-deep);
  position:absolute;
  top:5px;
}

/* åº•éƒ¨ */
footer{
  margin-top:12px;
  text-align:center;
  font-size:.78rem;
  color:#888;
}
</style>
</head>
<body>

<!-- é¡¶éƒ¨ä¿¡æ¯ -->
<section class="top-card">
  <div class="top-row-1">
    <div class="brand">
      <div class="brand-logo">ğŸ’Œ</div>
      <div>
        <div class="brand-text-main">ä½ çš„åå­—ä¸€å‡ºç°ï¼Œæˆ‘å°±è½¯äº†ã€‚</div>
        <div class="brand-text-sub">ç‚¹æ—¥å†ï¼Œçœ‹ä¸€å°åªå†™ç»™ä½ çš„å°ä¿¡å°ã€‚</div>
      </div>
    </div>
    <button id="btnToday" class="btn-today">
      <span>å›åˆ°ä»Šå¤©</span> <span>ğŸ“</span>
    </button>
  </div>
  <div class="top-row-2">
    <div class="pill pill-strong">
      ğŸ¾ åœ¨ä¸€èµ·ç¬¬
      <code id="daysTogether">0000</code>
      å¤©
    </div>
    <div class="pill">
      â˜ï¸ ä»Šå¤©çš„èƒ¶å›Šé¦™æ°”ï¼š
      <span id="todayScent">è‰è“å¥¶éœœ</span>
    </div>
  </div>
</section>

<!-- ä¸­éƒ¨é¢„è§ˆ -->
<section class="preview-card">
  <div class="preview-head">
    <div class="select-wrap">
      <select id="yearSelect"></select>
      <select id="monthSelect"></select>
    </div>
  </div>

  <div class="preview-chips">
    <div class="preview-chip">ä»Šæ—¥ï¼š<span id="todayLabel"></span></div>
    <div class="preview-chip">çš®è‚¤ï¼šé©¬å¡é¾™æ¸å˜</div>
  </div>

  <div class="preview-label">
    ğŸ‘€ é¢„è§ˆ <span id="previewDate" class="preview-date"></span>
  </div>
  <div class="preview-body" id="previewBody">
    å…ˆç‚¹ä¸‹é¢çš„æŸä¸€å¤©è¯•è¯•ï¼Œä¼šå¼¹å‡ºé‚£å¤©çš„å›ä¿¡ã€‚
  </div>
  <button class="btn-open" id="btnOpen">
    æ‰“å¼€ä¿¡å° ğŸ’Œ
  </button>
</section>

<!-- æ—¥å† -->
<section class="calendar-card">
  <div class="calendar-header">æƒ³çœ‹å“ªä¸€å¤©çš„ä¿¡ï¼Ÿç‚¹ä¸‹é¢çš„æ—¥æœŸå°±å¥½ã€‚</div>
  <div id="calendar" class="calendar"></div>
</section>

<footer>è¯­æ–™æ¥è‡ª dateMessages.js Â· ç½‘é¡µå¯ç¦»çº¿ä½¿ç”¨</footer>

<!-- å¤–éƒ¨å¯„è¯­æ–‡ä»¶ -->
<script src="dateMessages.js"></script>

<script>
/* ===== é…ç½®ï¼ˆä½ ä»¥åå¯ä»¥è®© 4o æ¥å¸®ä½ æ”¹è¿™é‡Œï¼‰ ===== */
const CONFIG = {
  startDate: "2025-01-01",        // åœ¨ä¸€èµ·çš„èµ·å§‹æ—¥æœŸ
  defaultScent: "è‰è“å¥¶éœœ"        // ä»Šå¤©çš„é»˜è®¤â€œé¦™æ°”â€
};

/* ===== å·¥å…·å‡½æ•° ===== */
const $ = s => document.querySelector(s);
const msgs = window.dateMessages || {};

const today = new Date();
const todayKey = fmt(today);

let currentYear = today.getFullYear();
let currentMonth = today.getMonth(); // 0-index
let previewKey = todayKey;           // å½“å‰é¢„è§ˆçš„æ—¥æœŸ key

// æœ¬åœ°æ—¥æœŸ -> YYYY-MM-DDï¼ˆä¸å†ç”¨ toISOStringï¼Œé¿å…æ—¶åŒºé”™ä¸€å¤©ï¼‰
function fmt(d){
  const y = d.getFullYear();
  const m = String(d.getMonth() + 1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

function isToday(d){
  return d.getFullYear()===today.getFullYear()
      && d.getMonth()===today.getMonth()
      && d.getDate()===today.getDate();
}

function daysSince(startStr){
  const s = new Date(startStr);
  // åªå–â€œæ—¥å†æ„ä¹‰ä¸Šçš„æ—¥æœŸâ€ï¼Œå¿½ç•¥å°æ—¶
  s.setHours(0,0,0,0);
  const t = new Date();
  t.setHours(0,0,0,0);
  const diffMs = t - s;
  // +1 è¡¨ç¤ºä»ç¬¬ä¸€å¤©ç®—èµ·å°±æ˜¯â€œç¬¬ 1 å¤©â€
  return diffMs>=0 ? Math.floor(diffMs/86400000)+1 : 0;
}

/* ===== å¡«å†™é¡¶éƒ¨ä¿¡æ¯ ===== */
function initTop(){
  $('#daysTogether').textContent = String(daysSince(CONFIG.startDate)).padStart(4,'0');
  $('#todayScent').textContent = CONFIG.defaultScent;
  $('#todayLabel').textContent = todayKey;
}

/* ===== å¡«å……å¹´ä»½ã€æœˆä»½ä¸‹æ‹‰ ===== */
function initSelects(){
  const ySel = $('#yearSelect');
  const mSel = $('#monthSelect');
  ySel.innerHTML = '';
  mSel.innerHTML = '';

  const base = today.getFullYear();
  const minYear = base - 2;
  const maxYear = base + 6;

  for(let y=minYear; y<=maxYear; y++){
    const opt = document.createElement('option');
    opt.value = String(y);
    opt.textContent = `${y} å¹´`;
    if(y===currentYear) opt.selected = true;
    ySel.appendChild(opt);
  }
  for(let m=0; m<12; m++){
    const opt = document.createElement('option');
    opt.value = String(m);
    opt.textContent = `${m+1} æœˆ`;
    if(m===currentMonth) opt.selected = true;
    mSel.appendChild(opt);
  }

  ySel.onchange = () => {
    currentYear = parseInt(ySel.value,10);
    drawCalendar();
  };
  mSel.onchange = () => {
    currentMonth = parseInt(mSel.value,10);
    drawCalendar();
  };
}

/* ===== æ¸²æŸ“æ—¥å† ===== */
function drawCalendar(){
  const cal = $('#calendar');
  cal.innerHTML = '';

  const y = currentYear;
  const m = currentMonth;

  // æ˜ŸæœŸè¡Œ
  'æ—¥ä¸€äºŒä¸‰å››äº”å…­'.split('').forEach(w=>{
    const wd = document.createElement('div');
    wd.className = 'wd';
    wd.textContent = w;
    cal.appendChild(wd);
  });

  const first = new Date(y,m,1);
  const offset = first.getDay();
  const days = new Date(y,m+1,0).getDate();

  // å‰ç½®ç©ºä½
  for(let i=0;i<offset;i++){
    const blank = document.createElement('div');
    blank.className = 'day disabled';
    cal.appendChild(blank);
  }

  // æ—¥æœŸæ ¼
  for(let d=1; d<=days; d++){
    const date = new Date(y,m,d);
    const key = fmt(date);
    const cell = document.createElement('div');
    cell.className = 'day';
    cell.textContent = d;

    if(msgs[key]){
      cell.classList.add('has');
      cell.dataset.icon = msgs[key].icon || 'â­';
    }
    if(isToday(date)) cell.classList.add('today');
    if(key === previewKey) cell.classList.add('sel');

    cell.onclick = () => {
      previewKey = key;
      updatePreview();
      drawCalendar(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€
    };

    cal.appendChild(cell);
  }
}

/* ===== æ›´æ–°é¢„è§ˆåŒºåŸŸ ===== */
function updatePreview(){
  $('#previewDate').textContent = previewKey || 'â€”â€”';
  const msg = msgs[previewKey];
  if(msg){
    const sign = msg.sign ? `\n${msg.sign}` : '';
    $('#previewBody').textContent = (msg.body || '') + sign;
  }else{
    $('#previewBody').textContent = 'ä»Šå¤©è¿˜æ²¡æœ‰å¯„è¯­ï¼Œç•™ä¸€ç‚¹æœŸå¾…å§ï½';
  }
}

/* ===== äº‹ä»¶ç»‘å®š ===== */
$('#btnToday').onclick = () => {
  currentYear = today.getFullYear();
  currentMonth = today.getMonth();
  previewKey = todayKey;
  $('#yearSelect').value = String(currentYear);
  $('#monthSelect').value = String(currentMonth);
  updatePreview();
  drawCalendar();
};

// â€œæ‰“å¼€ä¿¡å°â€åªæ˜¯ä¸€ä¸ªå°åŠ¨æ•ˆï¼Œè¿™é‡Œè®©å¡ç‰‡è½»å¾®æŠ–ä¸€ä¸‹
$('#btnOpen').onclick = () => {
  const card = document.querySelector('.preview-card');
  card.style.transform = 'translateY(-2px) scale(1.01)';
  card.style.transition = '.18s';
  setTimeout(()=>{
    card.style.transform = 'translateY(0) scale(1)';
  },180);
};

/* ===== åˆå§‹åŒ– ===== */
initTop();
initSelects();
updatePreview();
drawCalendar();
</script>
</body>
</html>
